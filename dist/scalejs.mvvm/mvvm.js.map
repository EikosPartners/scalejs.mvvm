{"version":3,"sources":["../../src/scalejs.mvvm/mvvm.js"],"names":[],"mappings":"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","file":"mvvm.js","sourcesContent":["/*global define,document*/\r\n/*jslint nomen: true*/\r\nimport ko from 'knockout';\r\nimport mapping from 'knockout.mapping';\r\nimport core from 'scalejs.core';\r\nimport ClassBindingProvider from './classBindingProvider';\r\nimport htmlTemplateSource from './htmlTemplateSource';\r\nimport selectableArray from './selectableArray';\r\nimport koUtils from './ko.utils';\r\n    \r\n\r\n    var merge = core.object.merge,\r\n        toArray = core.array.toArray,\r\n        classBindingProvider = new ClassBindingProvider({}, {\r\n            log: core.log.warn,\r\n            fallback: true\r\n        }),\r\n        root = ko.observable();\r\n\r\n    ko.bindingProvider.instance = classBindingProvider;\r\n\r\n    function observable(initialValue) {\r\n        return ko.observable(initialValue);\r\n    }\r\n\r\n    function observableArray(initialValue) {\r\n        return ko.observableArray(initialValue);\r\n    }\r\n\r\n    function computed(func) {\r\n        return ko.computed(func);\r\n    }\r\n\r\n    function toJson(viewModel) {\r\n        // Extracts underlying value from observables\r\n        return mapping.toJSON(viewModel);\r\n    }\r\n\r\n    function toObject(viewModel) {\r\n        return JSON.parse(toJson(viewModel));\r\n    }\r\n\r\n    function registerBindings() {\r\n        toArray(arguments).forEach(classBindingProvider.registerBindings.bind(classBindingProvider));\r\n    }\r\n\r\n    function toViewModel(data, viewModel, mappings) {\r\n        var knockoutStyleMappings = Object.keys(mappings).reduce(function (o, k) {\r\n            return merge(o, {\r\n                k: k,\r\n                create: function (options) { return mappings[k](options.data); }\r\n            });\r\n        }, {});\r\n\r\n        return mapping.fromJS(data, knockoutStyleMappings, viewModel);\r\n    }\r\n\r\n    function registerTemplates() {\r\n        toArray(arguments).forEach(htmlTemplateSource.registerTemplates);\r\n    }\r\n\r\n    function dataBinding(name, data) {\r\n        var binding = {};\r\n\r\n        binding[name] = data;\r\n\r\n        return binding;\r\n    }\r\n\r\n    function template(name, data) {\r\n        return dataBinding('template', {\r\n            name: name,\r\n            data: data\r\n        });\r\n    }\r\n\r\n    function dataClass(name, data) {\r\n        return {\r\n            dataClass: name,\r\n            viewmodel: data\r\n        };\r\n    }\r\n\r\n    function getElement(name) {\r\n        return document.getElementsByTagName(name)[0];\r\n    }\r\n\r\n    function init(config) {\r\n        var body,\r\n            opening_comment = document.createComment(' ko class: scalejs-shell '),\r\n            closing_comment = document.createComment(' /ko ');\r\n\r\n        // Set the node to the parent element of the currently running script\r\n        body = document.getElementsByTagName('script');\r\n        body = body[body.length - 1].parentElement;\r\n            Array.prototype.slice.call(document.getElementsByTagName(\"script\")).forEach(function (el) {\r\n                if ((el.getAttribute('data-main') || '').indexOf(\"app/app\") != -1) {\r\n                    body = el.parentElement\r\n                }\r\n            });\r\n\r\n        if (body === getElement('html') || body === getElement('head')) {\r\n            body = getElement('body');\r\n        }\r\n\r\n        if (body && !config.doNotRender) {\r\n            body.appendChild(opening_comment);\r\n            body.appendChild(closing_comment);\r\n\r\n            registerBindings({\r\n                'scalejs-shell': function (context) {\r\n                    return {\r\n                        render: context.$data.root\r\n                    };\r\n                }\r\n            });\r\n\r\n            ko.applyBindings({ root: root }, body);\r\n        }\r\n    }\r\n\r\n    export default {\r\n        core: {\r\n            mvvm: {\r\n                root: root,\r\n                toJson: toJson,\r\n                registerBindings: registerBindings,\r\n                registerTemplates: registerTemplates,\r\n                dataClass: dataClass,\r\n                template: template,\r\n                dataBinding: dataBinding,\r\n                selectableArray: selectableArray,\r\n                getRegisteredTemplates: htmlTemplateSource.getRegisteredTemplates,\r\n                ko: {\r\n                    utils: koUtils\r\n                }\r\n            }\r\n        },\r\n        sandbox: {\r\n            mvvm: {\r\n                observable: observable,\r\n                observableArray: observableArray,\r\n                computed: computed,\r\n                registerBindings: registerBindings,\r\n                registerTemplates: registerTemplates,\r\n                toJson: toJson,\r\n                toViewModel: toViewModel,\r\n                toObject: toObject,\r\n                dataClass: dataClass,\r\n                template: template,\r\n                dataBinding: dataBinding,\r\n                selectableArray: selectableArray,\r\n                getRegisteredTemplates: htmlTemplateSource.getRegisteredTemplates,\r\n                root: root\r\n            }\r\n        },\r\n        init: init\r\n    };\r\n\r\n"]}