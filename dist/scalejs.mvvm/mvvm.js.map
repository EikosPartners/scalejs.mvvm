{"version":3,"sources":["../../src/scalejs.mvvm/mvvm.js"],"names":["merge","object","toArray","array","classBindingProvider","log","warn","fallback","root","observable","bindingProvider","instance","initialValue","observableArray","computed","func","toJson","viewModel","toJSON","toObject","JSON","parse","registerBindings","arguments","forEach","bind","toViewModel","data","mappings","knockoutStyleMappings","Object","keys","reduce","o","k","create","options","fromJS","registerTemplates","dataBinding","name","binding","template","dataClass","viewmodel","getElement","document","getElementsByTagName","init","config","body","opening_comment","createComment","closing_comment","length","parentElement","Array","prototype","slice","call","el","getAttribute","indexOf","doNotRender","appendChild","context","render","$data","applyBindings","core","mvvm","selectableArray","getRegisteredTemplates","ko","utils","sandbox"],"mappings":";;;;;;AAEA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;;;AAGI,IAAIA,QAAQ,kBAAKC,MAAL,CAAYD,KAAxB;AAAA,IACIE,UAAU,kBAAKC,KAAL,CAAWD,OADzB;AAAA,IAEIE,uBAAuB,mCAAyB,EAAzB,EAA6B;AAChDC,SAAK,kBAAKA,GAAL,CAASC,IADkC;AAEhDC,cAAU;AAFsC,CAA7B,CAF3B;AAAA,IAMIC,OAAO,mBAAGC,UAAH,EANX,C,CAXJ;AACA;;;AAkBI,mBAAGC,eAAH,CAAmBC,QAAnB,GAA8BP,oBAA9B;;AAEA,SAASK,UAAT,CAAoBG,YAApB,EAAkC;AAC9B,WAAO,mBAAGH,UAAH,CAAcG,YAAd,CAAP;AACH;;AAED,SAASC,eAAT,CAAyBD,YAAzB,EAAuC;AACnC,WAAO,mBAAGC,eAAH,CAAmBD,YAAnB,CAAP;AACH;;AAED,SAASE,QAAT,CAAkBC,IAAlB,EAAwB;AACpB,WAAO,mBAAGD,QAAH,CAAYC,IAAZ,CAAP;AACH;;AAED,SAASC,MAAT,CAAgBC,SAAhB,EAA2B;AACvB;AACA,WAAO,mBAAQC,MAAR,CAAeD,SAAf,CAAP;AACH;;AAED,SAASE,QAAT,CAAkBF,SAAlB,EAA6B;AACzB,WAAOG,KAAKC,KAAL,CAAWL,OAAOC,SAAP,CAAX,CAAP;AACH;;AAED,SAASK,gBAAT,GAA4B;AACxBpB,YAAQqB,SAAR,EAAmBC,OAAnB,CAA2BpB,qBAAqBkB,gBAArB,CAAsCG,IAAtC,CAA2CrB,oBAA3C,CAA3B;AACH;;AAED,SAASsB,WAAT,CAAqBC,IAArB,EAA2BV,SAA3B,EAAsCW,QAAtC,EAAgD;AAC5C,QAAIC,wBAAwBC,OAAOC,IAAP,CAAYH,QAAZ,EAAsBI,MAAtB,CAA6B,UAAUC,CAAV,EAAaC,CAAb,EAAgB;AACrE,eAAOlC,MAAMiC,CAAN,EAAS;AACZC,eAAGA,CADS;AAEZC,oBAAQ,gBAAUC,OAAV,EAAmB;AAAE,uBAAOR,SAASM,CAAT,EAAYE,QAAQT,IAApB,CAAP;AAAmC;AAFpD,SAAT,CAAP;AAIH,KAL2B,EAKzB,EALyB,CAA5B;;AAOA,WAAO,mBAAQU,MAAR,CAAeV,IAAf,EAAqBE,qBAArB,EAA4CZ,SAA5C,CAAP;AACH;;AAED,SAASqB,iBAAT,GAA6B;AACzBpC,YAAQqB,SAAR,EAAmBC,OAAnB,CAA2B,6BAAmBc,iBAA9C;AACH;;AAED,SAASC,WAAT,CAAqBC,IAArB,EAA2Bb,IAA3B,EAAiC;AAC7B,QAAIc,UAAU,EAAd;;AAEAA,YAAQD,IAAR,IAAgBb,IAAhB;;AAEA,WAAOc,OAAP;AACH;;AAED,SAASC,QAAT,CAAkBF,IAAlB,EAAwBb,IAAxB,EAA8B;AAC1B,WAAOY,YAAY,UAAZ,EAAwB;AAC3BC,cAAMA,IADqB;AAE3Bb,cAAMA;AAFqB,KAAxB,CAAP;AAIH;;AAED,SAASgB,SAAT,CAAmBH,IAAnB,EAAyBb,IAAzB,EAA+B;AAC3B,WAAO;AACHgB,mBAAWH,IADR;AAEHI,mBAAWjB;AAFR,KAAP;AAIH;;AAED,SAASkB,UAAT,CAAoBL,IAApB,EAA0B;AACtB,WAAOM,SAASC,oBAAT,CAA8BP,IAA9B,EAAoC,CAApC,CAAP;AACH;;AAED,SAASQ,IAAT,CAAcC,MAAd,EAAsB;AAClB,QAAIC,IAAJ;AAAA,QACIC,kBAAkBL,SAASM,aAAT,CAAuB,2BAAvB,CADtB;AAAA,QAEIC,kBAAkBP,SAASM,aAAT,CAAuB,OAAvB,CAFtB;;AAIA;AACAF,WAAOJ,SAASC,oBAAT,CAA8B,QAA9B,CAAP;AACAG,WAAOA,KAAKA,KAAKI,MAAL,GAAc,CAAnB,EAAsBC,aAA7B;AACIC,UAAMC,SAAN,CAAgBC,KAAhB,CAAsBC,IAAtB,CAA2Bb,SAASC,oBAAT,CAA8B,QAA9B,CAA3B,EAAoEvB,OAApE,CAA4E,UAAUoC,EAAV,EAAc;AACtF,YAAI,CAACA,GAAGC,YAAH,CAAgB,WAAhB,KAAgC,EAAjC,EAAqCC,OAArC,CAA6C,SAA7C,KAA2D,CAAC,CAAhE,EAAmE;AAC/DZ,mBAAOU,GAAGL,aAAV;AACH;AACJ,KAJD;;AAMJ,QAAIL,SAASL,WAAW,MAAX,CAAT,IAA+BK,SAASL,WAAW,MAAX,CAA5C,EAAgE;AAC5DK,eAAOL,WAAW,MAAX,CAAP;AACH;;AAED,QAAIK,QAAQ,CAACD,OAAOc,WAApB,EAAiC;AAC7Bb,aAAKc,WAAL,CAAiBb,eAAjB;AACAD,aAAKc,WAAL,CAAiBX,eAAjB;;AAEA/B,yBAAiB;AACb,6BAAiB,sBAAU2C,OAAV,EAAmB;AAChC,uBAAO;AACHC,4BAAQD,QAAQE,KAAR,CAAc3D;AADnB,iBAAP;AAGH;AALY,SAAjB;;AAQA,2BAAG4D,aAAH,CAAiB,EAAE5D,MAAMA,IAAR,EAAjB,EAAiC0C,IAAjC;AACH;AACJ;;kBAEc;AACXmB,UAAM;AACFC,cAAM;AACF9D,kBAAMA,IADJ;AAEFQ,oBAAQA,MAFN;AAGFM,8BAAkBA,gBAHhB;AAIFgB,+BAAmBA,iBAJjB;AAKFK,uBAAWA,SALT;AAMFD,sBAAUA,QANR;AAOFH,yBAAaA,WAPX;AAQFgC,sDARE;AASFC,oCAAwB,6BAAmBA,sBATzC;AAUFC,gBAAI;AACAC;AADA;AAVF;AADJ,KADK;AAiBXC,aAAS;AACLL,cAAM;AACF7D,wBAAYA,UADV;AAEFI,6BAAiBA,eAFf;AAGFC,sBAAUA,QAHR;AAIFQ,8BAAkBA,gBAJhB;AAKFgB,+BAAmBA,iBALjB;AAMFtB,oBAAQA,MANN;AAOFU,yBAAaA,WAPX;AAQFP,sBAAUA,QARR;AASFwB,uBAAWA,SATT;AAUFD,sBAAUA,QAVR;AAWFH,yBAAaA,WAXX;AAYFgC,sDAZE;AAaFC,oCAAwB,6BAAmBA,sBAbzC;AAcFhE,kBAAMA;AAdJ;AADD,KAjBE;AAmCXwC,UAAMA;AAnCK,C","file":"mvvm.js","sourcesContent":["/*global define,document*/\r\n/*jslint nomen: true*/\r\nimport ko from 'knockout';\r\nimport mapping from 'knockout.mapping';\r\nimport core from 'scalejs.core';\r\nimport ClassBindingProvider from './classBindingProvider';\r\nimport htmlTemplateSource from './htmlTemplateSource';\r\nimport selectableArray from './selectableArray';\r\nimport koUtils from './ko.utils';\r\n    \r\n\r\n    var merge = core.object.merge,\r\n        toArray = core.array.toArray,\r\n        classBindingProvider = new ClassBindingProvider({}, {\r\n            log: core.log.warn,\r\n            fallback: true\r\n        }),\r\n        root = ko.observable();\r\n\r\n    ko.bindingProvider.instance = classBindingProvider;\r\n\r\n    function observable(initialValue) {\r\n        return ko.observable(initialValue);\r\n    }\r\n\r\n    function observableArray(initialValue) {\r\n        return ko.observableArray(initialValue);\r\n    }\r\n\r\n    function computed(func) {\r\n        return ko.computed(func);\r\n    }\r\n\r\n    function toJson(viewModel) {\r\n        // Extracts underlying value from observables\r\n        return mapping.toJSON(viewModel);\r\n    }\r\n\r\n    function toObject(viewModel) {\r\n        return JSON.parse(toJson(viewModel));\r\n    }\r\n\r\n    function registerBindings() {\r\n        toArray(arguments).forEach(classBindingProvider.registerBindings.bind(classBindingProvider));\r\n    }\r\n\r\n    function toViewModel(data, viewModel, mappings) {\r\n        var knockoutStyleMappings = Object.keys(mappings).reduce(function (o, k) {\r\n            return merge(o, {\r\n                k: k,\r\n                create: function (options) { return mappings[k](options.data); }\r\n            });\r\n        }, {});\r\n\r\n        return mapping.fromJS(data, knockoutStyleMappings, viewModel);\r\n    }\r\n\r\n    function registerTemplates() {\r\n        toArray(arguments).forEach(htmlTemplateSource.registerTemplates);\r\n    }\r\n\r\n    function dataBinding(name, data) {\r\n        var binding = {};\r\n\r\n        binding[name] = data;\r\n\r\n        return binding;\r\n    }\r\n\r\n    function template(name, data) {\r\n        return dataBinding('template', {\r\n            name: name,\r\n            data: data\r\n        });\r\n    }\r\n\r\n    function dataClass(name, data) {\r\n        return {\r\n            dataClass: name,\r\n            viewmodel: data\r\n        };\r\n    }\r\n\r\n    function getElement(name) {\r\n        return document.getElementsByTagName(name)[0];\r\n    }\r\n\r\n    function init(config) {\r\n        var body,\r\n            opening_comment = document.createComment(' ko class: scalejs-shell '),\r\n            closing_comment = document.createComment(' /ko ');\r\n\r\n        // Set the node to the parent element of the currently running script\r\n        body = document.getElementsByTagName('script');\r\n        body = body[body.length - 1].parentElement;\r\n            Array.prototype.slice.call(document.getElementsByTagName(\"script\")).forEach(function (el) {\r\n                if ((el.getAttribute('data-main') || '').indexOf(\"app/app\") != -1) {\r\n                    body = el.parentElement\r\n                }\r\n            });\r\n\r\n        if (body === getElement('html') || body === getElement('head')) {\r\n            body = getElement('body');\r\n        }\r\n\r\n        if (body && !config.doNotRender) {\r\n            body.appendChild(opening_comment);\r\n            body.appendChild(closing_comment);\r\n\r\n            registerBindings({\r\n                'scalejs-shell': function (context) {\r\n                    return {\r\n                        render: context.$data.root\r\n                    };\r\n                }\r\n            });\r\n\r\n            ko.applyBindings({ root: root }, body);\r\n        }\r\n    }\r\n\r\n    export default {\r\n        core: {\r\n            mvvm: {\r\n                root: root,\r\n                toJson: toJson,\r\n                registerBindings: registerBindings,\r\n                registerTemplates: registerTemplates,\r\n                dataClass: dataClass,\r\n                template: template,\r\n                dataBinding: dataBinding,\r\n                selectableArray: selectableArray,\r\n                getRegisteredTemplates: htmlTemplateSource.getRegisteredTemplates,\r\n                ko: {\r\n                    utils: koUtils\r\n                }\r\n            }\r\n        },\r\n        sandbox: {\r\n            mvvm: {\r\n                observable: observable,\r\n                observableArray: observableArray,\r\n                computed: computed,\r\n                registerBindings: registerBindings,\r\n                registerTemplates: registerTemplates,\r\n                toJson: toJson,\r\n                toViewModel: toViewModel,\r\n                toObject: toObject,\r\n                dataClass: dataClass,\r\n                template: template,\r\n                dataBinding: dataBinding,\r\n                selectableArray: selectableArray,\r\n                getRegisteredTemplates: htmlTemplateSource.getRegisteredTemplates,\r\n                root: root\r\n            }\r\n        },\r\n        init: init\r\n    };\r\n\r\n"]}